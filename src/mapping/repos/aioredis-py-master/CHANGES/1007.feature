Replace PubSub.run_in_thread with a coroutine PubSub.run.
